import"../chunks/CWj6FrbW.js";import{i as u}from"../chunks/CFs38dsS.js";import{o as d}from"../chunks/ZlsFigkP.js";import{D as m,p as w,f}from"../chunks/Qu5YHs-9.js";const k=m;function $(_,r){w(r,!1);const c="ee92s9l7bxh4fslbqh3svb3ul7hmfi",i="http://localhost:5173/login",l="http://127.0.0.1:3030/token";function h(e,s,o){return`https://id.twitch.tv/oauth2/authorize?response_type=token&client_id=${e}&redirect_uri=${s}&scope=&state=${o}`}d(async()=>{var a;if(new URLSearchParams(window.location.search).get("error")){alert("Could not authenticate");return}const o=new Map(window.location.hash.replace("#","").split("&").map(t=>t.split("=")));console.log(o);const n=o.get("access_token");if(!n){console.log("access token not found");const t=crypto.randomUUID();window.location.href=h(c,i,t),document.cookie=`auth_state=${t}; SameSite=strict; Secure`;return}if(((a=document.cookie.split("; ").find(t=>t.startsWith("auth_state=")))==null?void 0:a.split("=")[1])!==o.get("state")){alert("Try again"),console.warn("Cookie state does not match state returned by twitch");return}console.log("ideally here we would post token to the backend");try{const p=await(await fetch(l,{method:"POST",body:n})).json();k||(document.cookie=`session_token=${p}; SameSite=strict; Secure`),window.history.pushState({},"","/"),window.location.href="/"}catch(t){console.warn("Error when posting token",t)}}),u(),f()}export{$ as component};
